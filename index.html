<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Vẽ & Tính Toán Hình Khối 3D</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label, select, input, button { margin: 5px; }
    #canvas-container { width: 100%; height: 500px; background: black; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Vẽ & Tính Toán Hình Khối 3D</h1>

  <label for="shape">Chọn hình:</label>
  <select id="shape" onchange="updateForm(); clearScene();">
    <option value="cube">Hình lập phương</option>
    <option value="cylinder">Hình trụ</option>
    <option value="sphere">Hình cầu</option>
    <option value="cone">Hình nón</option>
    <option value="rectbox">Hộp chữ nhật</option>
  </select>

  <div id="params"></div>
  <button onclick="drawShape()">Vẽ hình</button>

  <p id="volume"></p>
  <p id="surface"></p>
  <p id="lateral"></p>

  <div id="canvas-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / 500, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, 500);
    document.getElementById("canvas-container").appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);

    camera.position.z = 10;
    let currentMesh;

    function updateForm() {
      const shape = document.getElementById("shape").value;
      const params = document.getElementById("params");
      params.innerHTML = "";
      if (shape === "cube") {
        params.innerHTML = 'Cạnh: <input id="edge" type="number" value="2">';
      } else if (shape === "cylinder" || shape === "cone") {
        params.innerHTML = 'Bán kính: <input id="radius" type="number" value="2"> Chiều cao: <input id="height" type="number" value="4">';
      } else if (shape === "sphere") {
        params.innerHTML = 'Bán kính: <input id="radius" type="number" value="2">';
      } else if (shape === "rectbox") {
        params.innerHTML = 'Dài: <input id="length" type="number" value="3"> Rộng: <input id="width" type="number" value="2"> Cao: <input id="height" type="number" value="1">';
      }
    }

    function clearScene() {
      if (currentMesh) {
        scene.remove(currentMesh);
        currentMesh.geometry.dispose();
        currentMesh.material.dispose();
        currentMesh = null;
      }
      document.getElementById("volume").innerText = "";
      document.getElementById("surface").innerText = "";
      document.getElementById("lateral").innerText = "";
    }

    function drawShape() {
      clearScene();
      const shape = document.getElementById("shape").value;
      let geometry, volume = 0, area = 0, lateral = 0;

      if (shape === "cube") {
        const a = +document.getElementById("edge").value;
        geometry = new THREE.BoxGeometry(a, a, a);
        volume = a ** 3;
        area = 6 * a ** 2;
        lateral = 4 * a ** 2;
      } else if (shape === "cylinder") {
        const r = +document.getElementById("radius").value;
        const h = +document.getElementById("height").value;
        geometry = new THREE.CylinderGeometry(r, r, h, 32);
        volume = Math.PI * r ** 2 * h;
        lateral = 2 * Math.PI * r * h;
        area = lateral + 2 * Math.PI * r ** 2;
      } else if (shape === "sphere") {
        const r = +document.getElementById("radius").value;
        geometry = new THREE.SphereGeometry(r, 32, 32);
        volume = 4/3 * Math.PI * r ** 3;
        lateral = area = 4 * Math.PI * r ** 2;
      } else if (shape === "cone") {
        const r = +document.getElementById("radius").value;
        const h = +document.getElementById("height").value;
        const l = Math.sqrt(r ** 2 + h ** 2);
        geometry = new THREE.ConeGeometry(r, h, 32);
        volume = 1/3 * Math.PI * r ** 2 * h;
        lateral = Math.PI * r * l;
        area = lateral + Math.PI * r ** 2;
      } else if (shape === "rectbox") {
        const l = +document.getElementById("length").value;
        const w = +document.getElementById("width").value;
        const h = +document.getElementById("height").value;
        geometry = new THREE.BoxGeometry(l, w, h);
        volume = l * w * h;
        area = 2 * (l * w + l * h + w * h);
        lateral = 2 * h * (l + w);
      }

      const material = new THREE.MeshBasicMaterial({ color: 0x6699ff, transparent: true, opacity: 0.6 });
      const mesh = new THREE.Mesh(geometry, material);

      const edges = new THREE.EdgesGeometry(geometry);
      const lines = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000 }));

      const group = new THREE.Group();
      group.add(mesh);
      group.add(lines);

      scene.add(group);
      currentMesh = group;

      const f = x => parseFloat(x.toFixed(2)).toString(); // remove .00
      document.getElementById("volume").innerText = `Thể tích: ${f(volume)}`;
      document.getElementById("surface").innerText = `Diện tích toàn phần: ${f(area)}`;
      document.getElementById("lateral").innerText = `Diện tích xung quanh: ${f(lateral)}`;
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    updateForm();
    animate();
  </script>
</body>
</html>
